<!DOCTYPE html>
<html lang="en-us" class="wf-firasans-n4-active wf-active">
	<head>
    <link href="http://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- Enable responsiveness on mobile devices --> 
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    
    	
    <meta name="generator" content="Hugo 0.37.1" />
    
    <title>Salt The Earth &middot; YourTech</title>
    <meta content="Salt The Earth - YourTech" property="og:title">
    <meta content=" - " property="og:description">    
    <!-- CSS --> 
    <link href="https://fonts.googleapis.com/css?family=Fira+Sans:300,300i,400,400i|Roboto+Mono:300,300i,400,400i,700,700i" rel="stylesheet">
    <link rel="stylesheet" href="http://localhost:1313css/print.css" media="print">
    <link rel="stylesheet" href="http://localhost:1313css/poole.css">
    <link rel="stylesheet" href="http://localhost:1313css/hyde.css">
    
    <script defer src="https://use.fontawesome.com/releases/v5.0.9/js/all.js" integrity="sha384-8iPTk2s/jMVj81dnzb/iFR2sdA7u06vHJyyLlAd4snFpCl/SnyUjRrbdJsw1pGIl" crossorigin="anonymous"></script>
    <!-- highlight.js--> 
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
    <!-- Customised CSS -->
    <link rel="stylesheet" href="http://localhost:1313css/custom.css">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="/favicon.png">
    

	</head>
    <body class="theme-base-0b " >
        <div class="sidebar">
	<div class="container text-center sidebar-sticky">
		<div class="sidebar-about text-center">
			<a href="http://localhost:1313"><h1 class="brand">YourTech</h1></a>
			 <img src="/img/ytjohnthumbnail.png" alt="Author Image" class="img-circle headshot center"> 
			<p class="lead">
				 Just your average, ordinary, everyday, super admin. 
			</p>
		</div>
		
<div>
	<ul class="sidebar-nav">
		
		
				<li>
					<a href="/posts/"> <span>Posts</span></a>
				</li>
				<li>
					<a href="/about/"> <span>About</span></a>
				</li>
		</li>
	</ul>
</div>

        <p>
		<section class="row text-center">
	
	<a href="https://twitter.com/ytjohn"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a>
	
	
	
	&nbsp;<a href="https://github.com/ytjohn"><i class="fab fa-github fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	&nbsp;<a href="https://stackoverflow.com/users/ytjohn"><i class="fab fa-stack-overflow fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	&nbsp;<a href="mailto:john@yourtech.us"><i class="fas fa-at fa-lg" aria-hidden="true"></i></a>
	
</section>

        </p>

		<p class="copyright">&copy; 2018 John Hogenmiller.
        <a href="https://creativecommons.org/licenses/by/4.0">Some Rights Reserved</a>.<br/>Built with <a href="https://gohugo.io/">Hugo</a> &amp; <a href="https://github.com/htr3n/hyde-hyde">hyde-hyde</a>.
        </p>
	</div>
	<div>
	</div>
</div>

        <div class="content container">
            <div class="post">
  <h1>Salt The Earth</h1>
  
  <div class="col-sm-12 col-md-12">
    <span class="text-left post-date meta">
            
       
        <i class="fas fa-calendar-alt"></i> 2014-04-29
      
      
      
      
      </span>  
  </div>    
  
  

<h2 id="learning-salt">Learning Salt</h2>

<p>I am just beginning to read up on <a href="http://docs.saltstack.com/en/latest/topics/tutorials/walkthrough.html">SaltStack</a>, but I am really liking it. It has a number of things I like from Ansible (separation from code and state), the targeting abilities of mcollective, and the centralized control of Puppet/Chef. Salt can be run masterless, but in a master/minion configuration, it uses a message queue (0mq) to control minions and get information back. All messages in this queue are encrypted using keys on both the minion and the master. If you distribute this key, you can consume salt generated data in other programs.</p>

<p>Running commands across all minions could look lik this:</p>

<pre><code>salt '*' test.ping
salt '*' disk.percent
</code></pre>

<p>In these, test.ping and disk.percent are known as &lsquo;execution modules&rsquo;, which are essentially python modules that contain defined functions. For example, disk would be an &lsquo;execution module&rsquo; and &ldquo;percent&rdquo; would be a function defined. Here, test.ping runs on all target hosts and returns &ldquo;True&rdquo;; disk.percent returns the percentage of disk usage on all minions.</p>

<p>You can also run ad-hoc commands.</p>

<pre><code>salt '*' cmd.run 'ls -l /etc'
</code></pre>

<p>Of course, you can target blocks of systems by hostname (<code>web*</code> will match web, web1, web02, webserver,..). Salt also has something called <a href="http://docs.saltstack.com/en/latest/topics/targeting/grains.html">Grains</a> which everyone else calls facts. You can target based on the grains, or use salt to provide a report based on the grains. The following command will return the number of cpus for every 64-bit cpu.</p>

<pre><code>salt -G 'cpuarch:x86_64' grains.item num_cpus
</code></pre>

<p>I <em>think</em> this would work as well:</p>

<pre><code>salt -G 'cpuarch:x86_64 and num_cpus:4' test.ping
</code></pre>

<p>If not, these would work (Compound match):</p>

<pre><code>salt -C 'G@cpuarch:x86_64 and G@num_cpus:4' test.ping
salt -c 'G@os:Ubuntu or G@os.Debian' test.ping
</code></pre>

<h2 id="salt-states">Salt States</h2>

<p>In Puppet, your manifests and modules are very closely coupled in puppet code. In Ansible, they separate things into modules and &ldquo;playbooks&rdquo;. These playbooks are yaml files detailing what modules and values for ansible to use. Salt follows this pattern as well, separating execution modules from states with &ldquo;Salt States&rdquo;, aka SLS formulas (aka state modules).</p>

<p>A sample SLS formual for installing nginx would look like this:</p>

<pre><code>nginx:
  pkg:
    - installed
  service:
    - running
    - require:
      - pkg: nginx
</code></pre>

<p>Assuming you save that in the right spot (/srv/salt/nginx/init.sls), you can apply this state module to all servers starting with the name &lsquo;web&rsquo;.</p>

<pre><code>salt 'web*' state.sls nginx
</code></pre>

<p>So with one tool, you can query a large amount of data from all your minions, move them to a specific state, run ad-hoc style modules, etc. This can also all be expanded by writing your own python modules. Also, I&rsquo;m mostly interested in the ability to target modules and groups of hosts in one command, but it&rsquo;s worh noting that salt will do scheduling of jobs just like puppet and chef do.</p>

</div>
            <div class="footer">
                <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>

<script type="text/javascript">
    hljs.initHighlightingOnLoad();
</script>



            </div>
        </div>
        
                
    </body>
</html>
